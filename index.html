<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ğŸ» Panel Admin</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container { max-width: 800px; margin: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #a78bfa; }
    td button { padding: 5px 10px; }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>ğŸ» Panel de AdministraciÃ³n</h1>

    <h2>Mesas</h2>
    <button id="resetAll" class="btn reset">Resetear todas</button>
    <table>
      <thead>
        <tr>
          <th>Mesa</th>
          <th>Estado</th>
          <th>Ãšltima jugada</th>
          <th>AcciÃ³n</th>
        </tr>
      </thead>
      <tbody id="mesasTable"></tbody>
    </table>

    <h2>ğŸ† Ranking Global</h2>
    <ol id="rankingList"></ol>
  </div>

  <script>
    async function loadMesas(){
      const res = await fetch("/api/mesas");
      const mesas = await res.json();
      const tbody = document.getElementById("mesasTable");
      tbody.innerHTML = mesas.map(m =>
        `<tr>
          <td>${m.id}</td>
          <td>${m.ocupado ? "ğŸ”’ Ocupada" : "âœ… Libre"}</td>
          <td>${m.ultima_jugada ? new Date(m.ultima_jugada).toLocaleString() : "-"}</td>
          <td><button onclick="resetMesa('${m.id}')">Resetear</button></td>
        </tr>`
      ).join("");
    }

    async function resetMesa(id){
      await fetch(`/api/reset/${id}`, { method:"POST" });
      loadMesas();
    }

    async function resetAll(){
      await fetch(`/api/reset-all`, { method:"POST" });
      loadMesas();
    }

    async function loadRanking(){
      const res = await fetch("/api/ranking");
      const ranking = await res.json();
      document.getElementById("rankingList").innerHTML = ranking
        .map((r,i)=>`<li>ğŸ… ${i+1}. ${r.nombre} (${r.celular}) â€” ${r.puntos} pts</li>`)
        .join("");
    }

    document.getElementById("resetAll").addEventListener("click", resetAll);

    loadMesas();
    loadRanking();
  </script>
</body>
</html>
